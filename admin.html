<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ú–∞—Å—Ç–µ—Ä —Ä—è–¥–æ–º</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div class="wrap">
    <h1>–ê–¥–º–∏–Ω–∫–∞</h1>
    <p class="muted">–î–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Ç–µ—Ä–∞ –≤ –±–∞–∑—É (SQLite) —á–µ—Ä–µ–∑ API.</p>

    <div class="card">
      <div class="row">
        <label class="field"><span>–ò–º—è</span><input id="name" /></label>
        <label class="field"><span>–¢–µ–ª–µ—Ñ–æ–Ω</span><input id="phone" /></label>
      </div>

      <div class="row">
        <label class="field">
          <span>–£—Å–ª—É–≥–∞</span>
          <select id="service">
            <option value="plumber">–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫</option>
            <option value="electrician">–≠–ª–µ–∫—Ç—Ä–∏–∫</option>
            <option value="furniture">–°–±–æ—Ä–∫–∞ –º–µ–±–µ–ª–∏</option>
            <option value="handyman">–ú–∞—Å—Ç–µ—Ä –Ω–∞ —á–∞—Å</option>
          </select>
        </label>

        <label class="field"><span>–¶–µ–Ω–∞ –æ—Ç</span><input id="priceFrom" type="number" value="50"/></label>
      </div>

      <div class="row">
        <label class="field"><span>Rating (0‚Äì5)</span><input id="rating" type="number" step="0.1" value="4.6"/></label>
        <label class="field"><span>–ó–∞–∫–∞–∑–æ–≤</span><input id="jobs" type="number" value="0"/></label>
      </div>

      <div class="row">
        <label class="field"><span>–®–∏—Ä–æ—Ç–∞ (lat)</span><input id="lat" type="number" step="0.0001" placeholder="52.52"/></label>
        <label class="field"><span>–î–æ–ª–≥–æ—Ç–∞ (lng)</span><input id="lng" type="number" step="0.0001" placeholder="13.405"/></label>
      </div>

      <label class="field">
        <span>–û–ø–∏—Å–∞–Ω–∏–µ</span>
        <input id="tagline" placeholder="–ù–∞–ø—Ä. –ü—Ä–∏–µ–∑–∂–∞—é –±—ã—Å—Ç—Ä–æ" />
      </label>

      <label class="field" style="margin-top:10px;">
        <span><input id="isVerified" type="checkbox"/> –ü—Ä–æ–≤–µ—Ä–µ–Ω</span>
      </label>

      <div class="row">
        <button id="fillGeo">üìç –í—Å—Ç–∞–≤–∏—Ç—å –º–æ–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</button>
        <button id="save" class="primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>

      <pre id="status" class="status"></pre>
      <p class="muted">–û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: <a class="action" href="/">/</a></p>
    </div>
  </div>

<script>
const $ = (id) => document.getElementById(id);
const statusEl = $("status");

function setStatus(msg){ statusEl.textContent = msg || ""; }

$("fillGeo").addEventListener("click", () => {
  if (!navigator.geolocation) return setStatus("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.");
  setStatus("–û–ø—Ä–µ–¥–µ–ª—è—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã‚Ä¶");
  navigator.geolocation.getCurrentPosition(
    (p) => { $("lat").value = p.coords.latitude; $("lng").value = p.coords.longitude; setStatus("–ì–æ—Ç–æ–≤–æ ‚úÖ"); },
    () => setStatus("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é.")
  );
});

$("save").addEventListener("click", async () => {
  try {
    const payload = {
      name: $("name").value.trim(),
      phone: $("phone").value.trim(),
      service: $("service").value,
      priceFrom: Number($("priceFrom").value || 0),
      rating: Number($("rating").value || 4.5),
      jobs: Number($("jobs").value || 0),
      tagline: $("tagline").value.trim(),
      lat: Number($("lat").value),
      lng: Number($("lng").value),
      isVerified: $("isVerified").checked
    };

    setStatus("–°–æ—Ö—Ä–∞–Ω—è—é‚Ä¶");

    const res = await fetch("/api/masters", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json().catch(() => ({}));
    if (!res.ok) throw new Error(JSON.stringify(data));

    setStatus("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ id=" + data.id);
  } catch (e) {
    setStatus("–û—à–∏–±–∫–∞: " + e.message);
  }
});
</script>
</body>
</html>
